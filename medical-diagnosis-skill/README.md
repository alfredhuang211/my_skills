# Medical Diagnosis Assistant Skill

## 简介

智能医疗诊断助手技能，专注于过敏性鼻炎（Allergic Rhinitis, AR）的AI临床诊断与用药指导。

## 功能特性

✅ **结构化问诊** - 基于临床指南的系统化问诊树  
✅ **智能评分** - 自动计算TNSS评分，精准分型分度  
✅ **个性化方案** - 根据患者特征自动调整治疗方案  
✅ **安全用药** - 自动识别禁忌症和药物相互作用  
✅ **危险预警** - 实时检测危险信号，及时提示就医  
✅ **随访管理** - 支持用药后症状跟踪与方案调整  

## 技能触发

### 关键词触发
- **鼻部症状**：打喷嚏、流鼻涕、清水涕、鼻痒、鼻塞
- **疾病名称**：过敏、鼻炎、过敏性鼻炎、鼻敏感
- **用药咨询**：鼻炎吃什么药、怎么治疗

### 场景触发
- 用户描述≥2个鼻部症状
- 提到过敏史或季节性发作
- 询问鼻炎治疗建议

## 文件结构

```
medical-diagnosis-skill/
├── SKILL.md                          # 主技能文档（完整指南）
├── README.md                         # 本文件
├── scripts/
│   └── ar_diagnosis.py               # 诊断算法Python实现
└── references/
    ├── medication_database.json      # 药物数据库
    └── contraindications.json        # 禁忌症与安全规则
```

## 核心算法

### TNSS评分系统

| 症状 | 0分 | 1分 | 2分 | 3分 |
|-----|-----|-----|-----|-----|
| 打喷嚏 | 无 | 1-5个/天 | 6-10个/天 | ≥11个/天 |
| 流涕 | 无 | ≤5次擦拭 | 6-10次 | ≥11次或流淌 |
| 鼻痒 | 无 | ≤3次揉鼻 | 4-10次 | ≥11次 |
| 鼻塞 | 无 | 偶尔堵 | 白天也堵 | 全天双侧堵 |

**总分范围**：0-12分

### 分型分度

#### 病程分型
- **间歇性**：症状 <4天/周 或 <连续4周
- **持续性**：症状 ≥4天/周 且 ≥连续4周

#### 严重程度
- **轻度**：TNSS 0-4分，不影响生活
- **中度**：TNSS 5-8分，明显不适
- **重度**：TNSS 9-12分，严重影响

## 使用示例

### Python脚本测试

```bash
cd /Users/alfredhuang/Documents/UGit/AI_Project/my_skills/medical-diagnosis-skill
python3 scripts/ar_diagnosis.py
```

### AI对话示例

**用户**：我最近老是打喷嚏，鼻子痒，还流清鼻涕

**AI**（使用本技能）：
```
您好！我注意到您出现了打喷嚏、鼻痒和流清鼻涕的症状。
这些可能是过敏性鼻炎的表现。为了给您准确的建议，我需要了解：

【症状频率】每天打多少个喷嚏？
□ 1-5个（偶尔）
□ 6-10个（经常）
□ 11个以上（频繁）

请选择...
```

*继续问诊 → 自动评分 → 生成诊断 → 推荐治疗方案*

## 安全保障

### 禁忌症自动识别
- ✅ 孕妇、哺乳期特殊方案
- ✅ 青光眼患者避免抗胆碱药
- ✅ 前列腺增生避免第一代抗组胺
- ✅ 肾功能不全自动调整剂量

### 危险信号检测
🚨 自动识别以下情况并立即提示就医：
- 哮喘发作（呼吸困难、喘息）
- 过敏性休克
- 鼻窦炎并发症
- 严重鼻出血

### 免责声明
每次问诊自动展示：
> ⚠️ 本AI助手提供的建议仅供参考，不构成正式医疗诊断。  
> 如症状持续或加重，请及时就医。

## 知识库来源

### 临床指南
- 中国过敏性鼻炎诊疗指南（2022版）
- ARIA指南（Allergic Rhinitis and its Impact on Asthma）

### 数据更新
- **离线缓存**：近5年诊疗指南、药品说明书、顶刊文献
- **在线更新**：PubMed、SinoMed、CNKI等医学数据库

## 技能优势

### vs 传统问诊
| 传统 | 本技能 |
|-----|-------|
| 主观判断 | 量化评分（TNSS） |
| 经验驱动 | 指南驱动 |
| 人工查阅禁忌 | 自动安全检查 |
| 难以追踪 | 完整记录可追溯 |

### vs 通用AI
| 通用AI | 本技能 |
|-------|-------|
| 泛泛建议 | 精准分型分度 |
| 可能遗漏禁忌 | 强制安全检查 |
| 无结构化流程 | 标准问诊树 |
| 无危险预警 | 实时信号检测 |

## 扩展性

### 支持的疾病（当前）
- ✅ 过敏性鼻炎

### 计划扩展
- 🔲 哮喘
- 🔲 慢性荨麻疹
- 🔲 过敏性结膜炎
- 🔲 特应性皮炎

## 开发者指南

### 添加新疾病

1. **更新SKILL.md** - 添加疾病诊断逻辑
2. **扩展medication_database.json** - 添加相关药物
3. **更新contraindications.json** - 添加禁忌规则
4. **实现ar_diagnosis.py** - 添加诊断类

### 代码规范

```python
# 遵循PEP 8
# 使用类型注解
# 完善文档字符串
# 单元测试覆盖

class NewDiseaseDiagnostic:
    """新疾病诊断类"""
    
    @staticmethod
    def classify(symptoms: Symptoms) -> Diagnosis:
        """
        诊断分类
        
        Args:
            symptoms: 症状对象
        
        Returns:
            诊断结果
        """
        pass
```

## 测试用例

运行测试：
```bash
python3 scripts/ar_diagnosis.py
```

预期输出：
```
================================================================================
示例1：中度持续性过敏性鼻炎
================================================================================
TNSS评分: 7分
严重程度: 中度
病程分型: 持续性

治疗方案:
主要用药:
  • {'name': '鼻用糖皮质激素（必需）', 'options': [...], ...}
  ...
```

## 法律与伦理

### 合规要求
- ✅ 不替代医生诊断
- ✅ 明确标注"仅供参考"
- ✅ 提示及时就医场景
- ✅ 数据加密存储

### 隐私保护
- 问诊记录加密
- 不泄露个人信息
- 用户可随时删除数据

## 版本历史

### v1.0 (2026-02-28)
- ✅ 初始版本
- ✅ 过敏性鼻炎完整诊断流程
- ✅ TNSS评分系统
- ✅ 阶梯治疗决策
- ✅ 安全用药规则
- ✅ 危险信号检测

## 贡献指南

欢迎贡献！请遵循以下流程：
1. Fork本项目
2. 创建特性分支
3. 提交更改
4. 发起Pull Request

## 联系方式

- 技能维护者：Medical AI Team
- 基于：中国过敏性鼻炎诊疗指南（2022版）

## 许可证

本技能仅供学习和研究使用。临床应用需获得相关医疗机构许可。

---

**⚠️ 重要提示**：本技能提供的医疗建议仅供参考，不能替代专业医生的诊断和治疗。如有健康问题，请及时就医。
